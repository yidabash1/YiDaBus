
@{
    ViewBag.Title = "高级搜索";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style type="text/css">
    html, body {
        position: relative;
        height: 100%;
        overflow: hidden;
    }
</style>
<div class="container" style="height:100%">
    <div class="search_listheader" style="position: relative;">
        <div class="search_listheader_l"><i class="iconfont icon-jiantou-copy1" onclick="return window.location.href='/Home/Index';"></i></div>
        <div class="search_listheader_m"><i class="iconfont icon-llhomesearch"></i><input type="text" placeholder="请输入小区、商圈、地铁站"></div>
        <div class="search_listheader_r">@*<i class="iconfont icon-03" onclick="jumpmap()"></i>*@</div>
    </div>
    <div class="saixuan">
        <ul>
            <li flag="1" id="d" class="cur">
                <span>区域<em><i class="iconfont icon-arrow-down-copy"></i></em></span>

            </li>
            <li flag="2" id="r">
                <span>租金<em><i class="iconfont icon-arrow-down-copy"></i></em></span>

            </li>
            <li flag="3" id="o">
                <span>户型<em><i class="iconfont icon-arrow-down-copy"></i></em></span>

            </li>
            <li flag="4" id="m" style="border-right:0; width:23%;">
                <span>更多<em><i class="iconfont icon-arrow-down-copy"></i></em></span>

            </li>
        </ul>
    </div>

    <div class="shaixuan_con" id="tab1">
        <div class="wareSort clearfix">
            <div class="search_box"><ul id="sort1"></ul></div>
            <div class="search_box"><ul id="sort2" style="display: none;"></ul></div>
            <div class="search_box"><ul id="sort3" style="display: none;"></ul></div>
        </div>
        @*<div class="shaixuan_btm">
                <a onclick="removeclass()">清除</a>
                <a class="bg2" onclick="jumptoresults()">确定(3)</a>
            </div>*@
    </div>
    <div class="shaixuan_con" id="tab2" style="display:none">
        <div class="wareSort2 clearfix">
            <ul>
                <li><a href="javascript:void(0)" data-value="">不限</a></li>
                <li><a href="javascript:void(0)" data-value="0-1500">1500元以下</a></li>
                <li><a href="javascript:void(0)" data-value="1500-3000">1500-3000元</a></li>
                <li><a href="javascript:void(0)" data-value="3000-4000">3000-4000元</a></li>
                <li><a href="javascript:void(0)" data-value="4000-5000">4000-5000元</a></li>
                <li><a href="javascript:void(0)" data-value="5000-7000">5000-7000元</a></li>
                <li><a href="javascript:void(0)" data-value="7000-0">7000元以上</a></li>

            </ul>

        </div>
        @*<div class="shaixuan_btm">
                <a onclick="removeclass()">清除</a>
                <a class="bg2" onclick="jumptoresults()">确定(3)</a>
            </div>*@
    </div>
    <div class="shaixuan_con" id="tab3" style="display:none">
        <div class="wareSort2 clearfix">
            <ul>
                <li><a href="javascript:void(0)" data-value="">不限</a></li>
                <li><a href="javascript:void(0)" data-value="1">1室</a></li>
                <li><a href="javascript:void(0)" data-value="2">2室</a></li>
                <li><a href="javascript:void(0)" data-value="3">3室</a></li>
                <li><a href="javascript:void(0)" data-value="4">4室</a></li>
                <li><a href="javascript:void(0)" data-value="5">4室以上</a></li>


            </ul>

        </div>
        @*<div class="shaixuan_btm">
                <a onclick="removeclass()">清除</a>
                <a class="bg2" onclick="jumptoresults()">确定(3)</a>
            </div>*@
    </div>
    <div class="shaixuan_con" id="tab4" style="display:none">
        <div class="wareSort3 clearfix">
            <div class="wareSort3_box" id="hDecoration">
                <h3>装修</h3>
                <div class="clear"></div>
                <ul>
                    <li><a href="javascript:void(0)" data-value="毛坯">毛坯</a></li>
                    <li><a href="javascript:void(0)" data-value="简装">简装</a></li>
                    <li><a href="javascript:void(0)" data-value="精装">精装</a></li>
                    <li><a href="javascript:void(0)" data-value="豪装">豪装</a></li>
                </ul>
            </div>
            <div class="wareSort3_box" id="floor">
                <h3>楼层</h3>
                <div class="clear"></div>
                <ul>
                    <li><a href="javascript:void(0)" data-value="低层">低层</a></li>
                    <li><a href="javascript:void(0)" data-value="中层">中层</a></li>
                    <li><a href="javascript:void(0)" data-value="高层">高层</a></li>
                </ul>
            </div>
            <div class="wareSort3_box" id="hrentarea">
                <h3>面积(㎡)</h3>
                <div class="clear"></div>
                <ul>
                    <li><a href="javascript:void(0)" data-value="0-50">50以下</a></li>
                    <li><a href="javascript:void(0)" data-value="50-70">50-70</a></li>
                    <li><a href="javascript:void(0)" data-value="70-90">70-90</a></li>
                    <li><a href="javascript:void(0)" data-value="90-110">90-110</a></li>
                    <li><a href="javascript:void(0)" data-value="110-130">110-130</a></li>
                    <li><a href="javascript:void(0)" data-value="130-150">130-150</a></li>
                    <li><a href="javascript:void(0)" data-value="150-200">150-200</a></li>
                    <li><a href="javascript:void(0)" data-value="200-0">200以上</a></li>
                </ul>
            </div>
            <div class="wareSort3_box" id="rentmodel">
                <h3>租赁形式</h3>
                <div class="clear"></div>
                <ul>
                    <li><a href="javascript:void(0)" data-value="合租">合租</a></li>
                    <li><a href="javascript:void(0)" data-value="整租">整租</a></li>

                </ul>
            </div>
            <div class="wareSort3_box" id="tags">
                <h3>标签</h3>
                <div class="clear"></div>
                <ul>
                    <li><a href="javascript:void(0)" data-value="地铁房">地铁房</a></li>
                    <li><a href="javascript:void(0)" data-value="随时看">随时看</a></li>
                    <li><a href="javascript:void(0)" data-value="白领房">白领房</a></li>
                    <li><a href="javascript:void(0)" data-value="优惠">优惠</a></li>
                    <li><a href="javascript:void(0)" data-value="拎包入住">拎包入住</a></li>
                    <li><a href="javascript:void(0)" data-value="小资生活">小资生活</a></li>
                </ul>
            </div>

        </div>
        <div class="shaixuan_btm">
            <a onclick="removeclass()">清除</a>
            <a class="bg2" onclick="jumptoresults()">确定(3)</a>
        </div>
    </div>


</div>

<script src="/content/js/jquery.sort.js?v1.0"></script>

<script type="text/javascript">

    $(document).ready(function () {
        $("body").removeClass();

        $(".wareSort2 ul li").click(function () {
            $(this).parent().find('li').removeClass();
            $(this).toggleClass("active");
            countSelect();
        });
        $(".wareSort3_box ul li").click(function () {

            $(this).toggleClass("cur");
            countSelect();
        });
    });
    $(function () {
        $(".saixuan ul li").mousedown(function () {
            // var flag = $(this).attr("flag");
            activeshow($(this));
            countSelect();
        });
        assignActive();
        countSelect();
        activeshow($("#@ViewBag.active"));
        intProvince("@ViewBag.isSubway"=="1"?"1":"0");
    })
    function activeshow(obj) {
        $(".saixuan ul li").each(function () {
            $(this).removeClass();
        });
        var flag = $(obj).attr("flag");
        $(obj).addClass("cur");
        $(".shaixuan_con").hide();
        $("#tab" + flag).show();
    }
</script>
<script>
    var districtSelected = '@ViewBag.district';
    function jumpmap() {
        window.location.href = "/house/mapsearch";
    }
    function removeclass() {
        $("li").removeClass();
        $(".bg2").html("确定(0)");
        districtSelected = "";
    }
    function countSelect() {
        var count = $("li.cur").length;
        $(".bg2").html("确定(" + (count - 1) + ")");
    }

    $("#tab2 .wareSort2 ul li").click(function () {
        $(this).parent().find("li").removeClass();
        $(this).addClass("active");
        jumptoresults();
    });
    $("#tab3 .wareSort2 ul li").click(function () {
        $(this).parent().find("li").removeClass();
        $(this).addClass("active");
        jumptoresults();
    });
    function jumptoresults() {
        var conditions = checkcondition();
        window.location.href = "/house/searchlist?" + conditions;
    }
    function checkcondition() {
        var conditions = ""
        conditions = conditions + "&keywords=" + $(".search_listheader_m input").val();
        //区域或者地铁选择
        var district1 = $("#tab1 .wareSort #sort3 li.active a").html();
        if (district1) {
            if (district1=="不限") {
                district1 = $("#tab1 .wareSort #sort2 li.active a").html();
                if (district1=="不限") {
                    district1 = "";
                }
            }
            conditions = conditions + "&District=" + district1;
        }
        else {
            conditions = conditions + "&District=" + districtSelected;
        }
        //租金选择
        var money = $("#tab2 .wareSort2 ul li.active a").data("value");
        if (money) {
            conditions = conditions + "&RentMoney=" + money;
        }
        //户型选择
        var room = $("#tab3 .wareSort2 ul li.active a").data("value")
        if (room) {
            conditions = conditions + "&HRoom=" + room;
        }
        //装修情况
        var hdecoration = "";
        $("#tab4 .wareSort3 #hDecoration ul li.cur a").each(function () {
            hdecoration = hdecoration + $(this).data("value") + ",";
        })
        conditions = conditions + "&hDecoration=" + hdecoration.substring(0, hdecoration.length - 1);
        //楼层
        var floor = ""
        $("#tab4 .wareSort3 #floor ul li.cur a").each(function () {
            console.log($(this).data("value"));
            floor = floor + $(this).data("value") + ",";
        })
        conditions = conditions + "&hfloor=" + floor.substring(0, floor.length - 1);

        //出租方式
        var rentmodel = ""
        $("#tab4 .wareSort3 #rentmodel ul li.cur a").each(function () {
            console.log($(this).data("value"));
            rentmodel = rentmodel + $(this).data("value") + ",";
        })
        conditions = conditions + "&rentModel=" + rentmodel.substring(0, rentmodel.length - 1);
        //标签
        var tags = ""
        $("#tab4 .wareSort3 #tags ul li.cur a").each(function () {

            tags = tags + $(this).data("value") + ",";
        })
        conditions = conditions + "&htags=" + tags.substring(0, tags.length - 1);
        //面积
        var hrentarea = ""
        $("#tab4 .wareSort3 #hrentarea ul li.cur a").each(function () {
            console.log($(this).data("value"));
            hrentarea = hrentarea + $(this).data("value") + ",";
        })
        conditions = conditions + "&RentalArea=" + hrentarea.substring(0, hrentarea.length - 1);
        return conditions;
    };

    function assignActive() {
        if ('@ViewBag.RentMoney' != "") {
            $("#tab2 .wareSort2 ul li a").each(function () {
                if ($(this).data("value") == '@ViewBag.RentMoney') {
                    $(this).parent().addClass("active");
                }
            });
        }
        if ('@ViewBag.HRoom' != "") {
            $("#tab3 .wareSort2 ul li a").each(function () {
                if ($(this).data("value") == '@ViewBag.HRoom') {
                    $(this).parent().addClass("active");
                }
            });
        }
        if ('@ViewBag.hfloor' != "") {
            var spfloor = '@ViewBag.hfloor'.split(',');
            for (var i = 0; i < spfloor.length; i++) {
                var obj = $("#tab4 .wareSort3 #floor ul li").find('a')
                $(obj).each(function () {
                    if ($(this).data("value") == spfloor[i]) {
                        $(this).parent().addClass("cur");
                    }
                })
            }
        }
        if ('@ViewBag.RentalArea' != "") {
            var spfloor = '@ViewBag.RentalArea'.split(',');
            for (var i = 0; i < spfloor.length; i++) {
                var obj = $("#tab4 .wareSort3 #hrentarea ul li").find('a')
                $(obj).each(function () {
                    if ($(this).data("value") == spfloor[i]) {
                        $(this).parent().addClass("cur");
                    }
                })
            }
        }
        if ('@ViewBag.hDecoration' != "") {
            var spfloor = '@ViewBag.hDecoration'.split(',');
            for (var i = 0; i < spfloor.length; i++) {
                var obj = $("#tab4 .wareSort3 #hDecoration ul li").find('a');
                $(obj).each(function () {
                    if ($(this).data("value") == spfloor[i]) {
                        $(this).parent().addClass("cur");
                    }
                })
            }
        }
        if ('@ViewBag.RentModel' != "") {
            var spfloor = '@ViewBag.RentModel'.split(',');
            for (var i = 0; i < spfloor.length; i++) {
                var obj = $("#tab4 .wareSort3 #rentmodel  ul li").find('a');
                $(obj).each(function () {
                    if ($(this).data("value") == spfloor[i]) {
                        $(this).parent().addClass("cur");
                    }
                })
            }
        }
        if ('@ViewBag.htags' != "") {
            var spfloor = '@ViewBag.htags'.split(',');
            for (var i = 0; i < spfloor.length; i++) {
                var obj = $("#tab4 .wareSort3 #tags  ul li").find('a');
                $(obj).each(function () {
                    if ($(this).data("value") == spfloor[i]) {
                        $(this).parent().addClass("cur");
                    }
                })


            }
        }
    };
</script>
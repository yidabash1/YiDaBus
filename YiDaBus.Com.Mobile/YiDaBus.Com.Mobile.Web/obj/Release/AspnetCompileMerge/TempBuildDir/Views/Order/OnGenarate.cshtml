@{
    ViewBag.Title = " 生成合同";
    Layout = "~/views/shared/_layout.cshtml";
}
<!--日期控件-->
<link href="/Content/js/mobiscroll/plugs/mobiscroll/css/mobiscroll.scroller.css" rel="stylesheet" />
<link href="~/Content/js/mobiscroll/plugs/mobiscroll/css/mobiscroll.scroller.android-ics.css" rel="stylesheet" />
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.core.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.scroller.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.datetime.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.scroller.android-ics.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.i18n.zh.js"></script>
<style>
    .wxtip {
        background: rgba(0,0,0,0.8);
        text-align: center;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 998;
        display: none;
    }

    .wxtip-icon {
        width: 52px;
        height: 67px;
        background: url(/Content/img/weixin-tip.png) no-repeat;
        display: block;
        position: absolute;
        right: 20px;
        top: 20px;
    }

    .wxtip-txt {
        margin-top: 107px;
        color: #fff;
        font-size: 16px;
        line-height: 1.5;
    }
</style>
<form id="ContractForm" class="layui-form">
    <div class="container">
        <div class="search_listheader" style="background:#fff">
            <div class="search_listheader_l" onclick="window.history.go(-1);"><i class="iconfont icon-jiantou-copy1"></i></div>
            <h2> 生成合同</h2>
            <div class="search_listheader_r" style="width:110px"><a href="https://www.sobot.com/chat/oldpc/index.html?sysNum=9dfdec2b55aa424e9c633babbb93dd17"><i class="iconfont icon-zixun"></i>在线法律帮助</a></div>
        </div>
        <div class="schetong_box">
            <h3>出租方（以下称为甲方）</h3>
            <ul>
                <li>
                    <span>姓      名</span>
                    <input id="id" name="id" type="hidden" lay-verify="required" lay-reqmsg="合同不存在或已被删除">
                    <input id="signatoryName" name="signatoryName" type="text" placeholder="请输入出租方姓名" lay-verify="required" lay-reqmsg="请输入出租方姓名">
                </li>
                <li><span>联系电话</span><input id="signatoryPhone" name="signatoryPhone" type="text" placeholder="请输入出租方的联系电话" lay-verify="required" lay-reqmsg="请输入出租方的联系电话"></li>
                <li><span>身份证号</span><input id="signatoryIDCard" name="signatoryIDCard" type="text" placeholder="请输入出租方的身份证号" lay-verify="identity" lay-reqmsg="请输入出租方的身份证号"></li>
            </ul>
        </div>
        <div class="schetong_box">
            <h3>承租方（以下简称乙方）</h3>
            <ul>
                <li><span>姓      名</span><input id="lessorName" name="lessorName" type="text" placeholder="请输入承租方姓名" lay-verify="required" lay-reqmsg="请输入承租方姓名"></li>
                <li><span>联系电话</span><input id="lessorPhone" name="lessorPhone" type="text" placeholder="请输入承租方的联系电话" lay-verify="required" lay-reqmsg="请输入承租方联系电话"></li>
                <li><span>身份证号</span><input id="lessorIDCard" name="lessorIDCard" type="text" placeholder="请输入承租方的身份证号" lay-verify="identity" lay-reqmsg="请输入承租方身份证号"></li>
            </ul>
        </div>
        <div class="schetong_box schetong_box1">
            <h3>租赁期限</h3>
            <ul>
                <li>
                    <span style="float:left;">开始日期</span>
                    <em>
                        <input type="text" style="width:70%;float:left;" name="contractSignTime" id="contractSignTime" lay-verify="required" placeholder="请选择" autocomplete="off" readonly="readonly" style="border:0px;float:left;" lay-reqmsg="请选择开始日期" />
                    </em>
                </li>
                <li>
                    <span style="float:left;">结束日期</span><em>
                        <input type="text" style="width:70%;float:left;" name="contractDueTime" id="contractDueTime" lay-verify="required" placeholder="请选择" autocomplete="off" readonly="readonly" style="border:0px;float:left;" lay-reqmsg="请选择结束日期" />
                    </em>
                </li>
            </ul>
        </div>
        <div class="schetong_box">
            <h3>租金</h3>
            <ul>
                <li>
                    <span>房子租金</span>
                    <input style="width:auto" type="text" placeholder="请输入每月房子租金" lay-verify="required" lay-reqmsg="请输入每月房子租金" id="contractAmount" name="contractAmount">
                    元/月（30天）
                </li>
            </ul>
        </div>
        <div class="schetong_box">
            <h3>付款方式</h3>
            <ul>
                <li><span>首次付款</span><input style="width: 60%;" type="text" placeholder="请输入首次付款共计金额" lay-verify="required" lay-reqmsg="请输入首次付款共计金额" id="firstPayment" name="firstPayment">元</li>
                <li><span>房屋押金</span><input style="width: 60%;" type="text" placeholder="请输入首付款中，房屋押金" lay-verify="required" lay-reqmsg="请输入房屋押金" id="houseDeposit" name="houseDeposit">元</li>
                <li>
                    <span>房      租</span>
                    <select class="No-Render" id="fTotalMonth" name="fTotalMonth" style="width: 20%;">
                        <option value="1">1月</option>
                        <option value="2">2月</option>
                        <option value="3">3月</option>
                        <option value="4">4月</option>
                        <option value="5">5月</option>
                        <option value="6">6月</option>
                        <option value="7">7月</option>
                        <option value="8">8月</option>
                        <option value="9">9月</option>
                        <option value="10">10月</option>
                        <option value="11">11月</option>
                        <option value="12">12月</option>
                    </select>
                    <input id="fTotalMoney" name="fTotalMoney" type="text" placeholder="请输入首付款中，房屋租金" lay-verify="number" lay-reqmsg="请输入首付款中，房屋租金" style="width: 50%;">元
                </li>
            </ul>
        </div>
        <div style="display:none;">
            <input id="city" name="city" />
            <input id="district" name="district" />
            <input id="detailAddress" name="detailAddress" />
            <input id="areasName" name="areasName" />
            <input id="buildingNO" name="buildingNO" />
            <input id="roomNO" name="roomNO" />
            <input id="hSpec" name="hSpec" />
            <input id="rentalArea" name="rentalArea" />
            <input id="signTime" name="signTime" />

            <input id="totalMonth" name="totalMonth" />
            <input id="bContractAmount" name="bContractAmount" />
            <input id="rentMoneyWay" name="rentMoneyWay" />
        </div>
        @*<a id="downFile" class="dowmmuban" href="/Order/SaveContract"><i class="iconfont icon-xiazai"></i> 下载合同模板,线下填写</a>*@
    </div>
    <div class="btmline"></div>
    <div class="detail_btmset">
        <div class="detail_btmset_part2" style="width:100%">
            <a href="javascript:void(0);" style="width:33%;background-color:#fff;color:#666666;" class="detail_btm_btn bg1" onclick="GoPreViewHandler();">预览</a>
            <a href="javascript:void(0);" style="width:67%" class="detail_btm_btn bg1" lay-submit="" lay-filter="submitForm">确认提交并在线生成合同</a>
        </div>
    </div>
</form>
<div class="wxtip" id="JweixinTip">
    <span class="wxtip-icon"></span>
    <p class="wxtip-txt">点击右上角<br />选择在浏览器中打开</p>
</div>
@Html.Partial("~/views/Shared/_ContractPartialPage.cshtml")
<script>
    $(function () {
        InitForm();
    });
    //下载模板
    function downTemplate() {
        $.download("/DownLoad/DownLoadFile", "filePath=/Template/房屋租赁合同模板.pdf&fileName=房屋租赁合同模板.pdf", "Post");
    }
    //对表单赋值
    function InitData() {
        $.ar({
            url: globalKey.InterfaceDomain + 'api/OrderLeaseContract/GetByOrderNo',
            data: { userId: $('#Uid').val(), orderNo: $.request('orderNo') },
            type: 'post',
            success: function (data) {
                $("#ContractForm").formSerialize(data.data);
                InitDate();
            }
        })
    }
    //初始化表单
    function InitForm() {
        layui.use(['form'], function () {
            var form = layui.form()
            , layer = layui.layer;
            //对表单赋值
            InitData();
            $('.settings select').bind('change', function () {
                InitDate();
            });

            //监听提交
            form.on('submit(submitForm)', function (data) {
                data.field["userId"] = $('#Uid').val();
                data.field["orderNo"] = $.request('orderNo');
                $.ar({
                    url: globalKey.InterfaceDomain + 'api/OrderLeaseContract/Update',
                    data: data.field,
                    type: 'post',
                    success: function (data) {
                        //$.modalMsg({
                        //    content: data.msg, success: function () {
                        //        window.location.href = "/Order/ContractDetail?orderNo=" + $.request('orderNo') + "&id=" + $('#id').val();
                        //        return false;
                        //    }
                        //});
                        window.location.href = "/Order/ContractDetail?orderNo=" + $.request('orderNo') + "&id=" + $('#id').val();
                    }
                })
                return false;
            });
        });
    }
    //初始化时间控件
    function InitDate() {
        var currYear = (new Date()).getFullYear();
        //初始化日期控件
        $('#contractSignTime,#contractDueTime').scroller('destroy').scroller({
            preset: 'date',
            theme: 'android-ics light',
            display: 'bottom',
            minDate: new Date(),
            endYear: currYear + 5, //结束年份
            lang: 'zh',
        });
        $("#contractSignTime,#contractDueTime").each(function (index, obj) {
            $(obj).scroller('setVal', $(obj).val(), true);
        });
    }
    //预览
    function GoPreViewHandler() {
        layui.use(['laytpl'], function () {
            var laytpl = layui.laytpl;
            var getTpl = $('#ContractTemplate').html();
            laytpl(getTpl).render($.serialize("ContractForm"), function (contentHtml) {
                var headHtml = '<div class="search_listheader" style="background:#fff" ><div class="search_listheader_l" onclick="$.modalCloseALL();"><i class="icon iconfont icon-2"></i></div><h2>  房屋租赁合同预览 </h2></div>';
                var footHtml = '<div class="btmline" style="height:15em;"></div>';
                var AllHtml = '<div style="height:' + $('body').height()*0.85 + 'px;overflow:auto;">' + headHtml + contentHtml + footHtml + '</div>';
                $.modalPage({ html: AllHtml });
            });
        })

    }
    //弹出在浏览器中打开的提示
    //$.weixinOpenInBrowserTip(document.getElementById('downFile'));
</script>
@{
    ViewBag.Title = "房源出价详细";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript" src="/content/js/WapCircleImg.js"></script>
<style>
    input[name="NoPassReason"] {
        width: 20px;
        height: 20px;
    }
</style>
<div class="container">
    <div class="box_main">
        <div class="search_listheader" style="background:#fff">
            <div class="search_listheader_l" onclick="return history.go(-1);"><i class="iconfont icon-jiantou-copy1"></i></div>
            <h2> 房源出价详细</h2>
        </div>
        <div class="box_title">

        </div>
        <div id="priceList"></div>
    </div>

</div>
<div class="overlay"></div>
<div class="jujue_tc">
    <h3>拒绝理由（可多选）</h3>
    <div class="jujue_tc_con">
        <dl>
            <dt>价格太低</dt>
            <dd><input name="NoPassReason" type="checkbox" value=""></dd>
        </dl>
        <dl>
            <dt>不喜欢这个租客</dt>
            <dd><input name="NoPassReason" type="checkbox" value=""></dd>
        </dl>
        <dl>
            <dt>我不想出租了</dt>
            <dd><input name="NoPassReason" type="checkbox" value=""></dd>
        </dl>
        <dl>
            <dt>其他</dt>
            <dd><input name="NoPassReason" type="checkbox" value=""></dd>
        </dl>
        <p class="jujue_tctips">做一个优秀房东，简单阐述下拒绝理由哦！</p>
    </div>
    <div class="hetong_tc_con_set">
        <a style="width:100%" class="hetong_tc_con_btn bg2" href="javascript:void(0)" onclick="NoPassSubmitHandler();">确认提交</a>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        houseDetails();
        priceList();
        $(".iprolist_tab2 ul li").mousedown(function () {
            $(".iprolist_tab2 ul li").each(function () {
                $(this).removeClass();
            });
            var flag = $(this).attr("flag");
            $(this).addClass("cur");
            $(".iprolistc").hide();
            $("#tab" + flag).show();
        });

    })
    $(document).ready(function () {
        //$(".fangwu_detail_boxtit .color_red").click(function () {
        //    $(".overlay").show();
        //    $(".jujue_tc").show()

        //});
        //$(".hetong_tc_con_btn").click(function () {
        //    $(".overlay").hide();
        //    $(".jujue_tc").hide();

        //});

    });
</script>
<!-- 房源模板-->
<script type="text/html" id="housedetails">
    {{# if(d!=null){ }}
    <div class="box_title_top" onclick="window.location.href = '/house/details/{{ d.houseDetail.id }}'">
        <h4>{{ d.houseDetail.houseTitle }}&nbsp;</h4>
        {{# if(d.houseDetail.rentMode!=""){ }} <span>{{ d.houseDetail.rentMode }}</span>{{# } }}
        <em><b>{{ d.houseDetail.hRent }}元</b>/月</em>
    </div>
    <p class="box_title_bot">{{ d.houseDetail.detailAddress }}</p>
    <div class="fangwu_detail_img" id="slider">
    </div>
    {{# } else{  }}
    <div class="search_null" style="display:none">
        <dl>
            <dt><img width="70" src="/content/img/null.png"></dt>
            <dd>房源不存在！</dd>
        </dl>
    </div>
    {{#  } }}
</script>
<!-- 出价模板-->
<script type="text/html" id="priceListTemplate">
    {{#  layui.each(d, function(index, item){}}
    {{# if(item.isDel==0){ }}
    {{# if(item.isAgree==0&&item.type==0){ }}
    <ul class="jinpai_box">
        <li>
            <div class="jinpai_top">
                <span class="jinpai_title"><i>{{ item.userName }}</i>--出价:</span>
                <span class="jinpai_price">{{ item.offerPrice}}元/月</span>
            </div>
            <div class="jinpai_center">
                <p>对你说：</p>
                <span class="jinpai_feedback">{{ $.FormatEmpty(item.toLandlordContent,"用户暂未填写") }}</span>
                <span class="jinpai_time">{{ $.formatDate(item.addTime,"yyyy-MM-dd ")}}</span>
            </div>
            <button class="jinpai_btn1"><a style="color:#000000;" href="tel:{{ item.userAccount}}">联系客户</a></button>
            <button class="jinpai_btn2" onclick="NoPassShowHandler('{{ item.id}}');">拒绝</button>
            <button class="jinpai_btn3" onclick="PassHandler('{{ item.id}}');">满意并确认</button>
        </li>
    </ul>
    {{#  } }}
    {{# if(item.isAgree==0&&item.type==1){ }}
    <ul class="ftf_box">
        <li>
            <div class="ftf_top">
                <span class="ftf_title"><i>{{ item.userName }}</i>发起当面签约</span>
                <span class="ftf_time">{{ $.formatDate(item.addTime,"yyyy-MM-dd ")}}</span>
            </div>
            <h4 class="ftf_center">{{ item.offerPrice}}元/月</h4>
            <button class="ftf_btn1" onclick="NoPassShowHandler('{{ item.id}}');">拒绝</button>
            <button class="ftf_btn2" onclick="PassHandler('{{ item.id}}');">确定签约</button>
        </li>
    </ul>
    {{#  } }}
    {{# if(item.isAgree==1){ }}
    <div class="fangwu_detail_box">
        <div class="fangwu_detail_boxtit" style="line-height: 30px;">
            <span>{{ item.userName }}-->出价：<b>￥{{ item.offerPrice}}/月</b></span>
            <em><img width="69" src="/Content/img/chegnjiao_icon.png"></em>
        </div>
        <div class="fangwu_detail_boxcon">
            <p>
                <em>对你说：</em>
                <label style="float:right;padding-top: 2px;color: #999999;font-size: 12px;">出价时间：{{ $.formatDate(item.addTime,"yyyy-MM-dd ")}} </label>
            </p>
            <div class="fangwu_detail_boxtime">{{ $.FormatEmpty(item.toLandlordContent,"用户暂未填写") }}</div>
        </div>
        <div class="yixiang_box_set w3">
            <ul>
                <li style="width:100%"><a href="tel:{{ item.userAccount}}">联系客户</a></li>
            </ul>
        </div>
    </div>
    {{#  } }}
    {{# if(item.isAgree==2){ }}
    <div class="fangwu_detail_box">
        <div class="fangwu_detail_boxtit" style="line-height: 30px;">
            <span>{{ item.userName }}-->出价：<b>￥{{ item.offerPrice}}/月</b></span>
            <em><img width="69" src="/Content/img/reject_icon.png"></em>
        </div>
        <div class="fangwu_detail_boxcon">
            <p>
                <em>对你说：</em>
                <label style="float:right;padding-top: 2px;color: #999999;font-size: 12px;">出价时间：{{ $.formatDate(item.addTime,"yyyy-MM-dd ")}} </label>
            </p>
            <div class="fangwu_detail_boxtime">{{ $.FormatEmpty(item.toLandlordContent,"用户暂未填写") }}</div>
        </div>
    </div>
    {{#  } }}
    
    {{#  }else{ }}
    <div class="fangwu_detail_box">
        <div class="fangwu_detail_boxtit" style="line-height: 30px;">
            <span>{{ item.userName }}-->出价：<b>￥{{ item.offerPrice}}/月</b></span>
            <em class="" style="color:#808080;">用户已删除</em>
        </div>
        <div class="fangwu_detail_boxcon">
            <p>
                <em>对你说：</em>
                <label style="float:right;padding-top: 2px;color: #999999;font-size: 12px;">出价时间：{{ $.formatDate(item.addTime,"yyyy-MM-dd ")}} </label>
            </p>
            <div class="fangwu_detail_boxtime">{{ $.FormatEmpty(item.toLandlordContent,"用户暂未填写") }}</div>
        </div>
    </div>
    {{#  } }}
    {{#  }); }}
    {{#  if(d.length === 0){ }}
    无数据
    {{#  } }}
</script>
<script>
    //房源模板
    function houseDetails() {
        $.LayDetails({
            elem: '.box_title'
            , Template: '#housedetails'
            , mb: 100
            , url: globalKey.InterfaceDomain + 'api/Users/GetLPriceHouseDetail'
            , type: 'post'
            , data: { houseId: $.request('houseId'), userId: $('#Uid').val() }//参数
        , success: function (html, data) {
            $('.box_title').html(html);
            //WapCircleImg_01("Cimgf0d5c2216b8cbscroller_imglist", 3, true);
        }
        });
    }
    //出价模板
    function priceList() {
        $.LayPage({
            elem: '#priceList'
      , Template: '#priceListTemplate'
      , mb: 100
      , url: globalKey.InterfaceDomain + 'api/Users/GetLPriceList'
      , type: 'post'
      , data: { houseId: $.request('houseId'), userId: $('#Uid').val() }//参数
        });
    }

    //满意并确认
    function PassHandler(id) {
        $.BottomDialog({
            content: '您确认要将该出价标记为满意吗?'
                    , callBack: function () {
                        $.ar({
                            url: globalKey.InterfaceDomain + 'api/Users/UpdateLPrice'
                           , data: { userId: $('#Uid').val(), leaseofferId: id, type: 0 }
                           , success: function (data) {
                               $.modalMsg({
                                   content: data.msg, success: function () {
                                       window.location.reload();
                                       return false;
                                   }
                               });
                           }
                        });
                        return false;
                    }
        });
    }
    var leaseofferId;
    //拒绝显示
    function NoPassShowHandler(id) {
        $('.overlay').show();
        $('.jujue_tc').slideDown();
        $('.jujue_tc_con>dl').each(function (index, obj) {
            $(obj).find('input:checkbox[name=NoPassReason]').prop('checked', false);
        });
        leaseofferId = id;
    }
    //拒绝隐藏
    $('.overlay').click(NoPassHideHandler);
    function NoPassHideHandler() {
        $('.overlay').hide();
        $('.jujue_tc').hide();
    }
    //$('.jujue_tc_con>dl').each(function (index, obj) {
    //    $(obj).click(function () {
    //        $(obj).find('input:checkbox[name=NoPassReason]').trigger('click');
    //    });
    //});
    //拒绝提交
    function NoPassSubmitHandler() {
        var noPassReason = '';
        $('input:checkbox[name=NoPassReason]:checked').each(function (index, obj) {
            noPassReason += $(obj).parents('dl').find('dt').text() + ',';
        });
        $.ar({
            url: globalKey.InterfaceDomain + 'api/Users/UpdateLPrice'
            , data: { userId: $('#Uid').val(), leaseofferId: leaseofferId, type: 1, noPassReason: noPassReason }
            , success: function (data) {
                $.modalMsg({
                    content: data.msg, success: function () {
                        window.location.reload();
                        return false;
                    }
                });
            }
        });
    }
</script>

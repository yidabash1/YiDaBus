@{
    ViewBag.Title = "房屋租赁合同";
    Layout = "~/views/shared/_layout.cshtml";
}

<!--日期控件-->
<link href="/Content/js/mobiscroll/plugs/mobiscroll/css/mobiscroll.scroller.css" rel="stylesheet" />
<link href="~/Content/js/mobiscroll/plugs/mobiscroll/css/mobiscroll.scroller.android-ics.css" rel="stylesheet" />
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.core.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.scroller.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.datetime.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.scroller.android-ics.js"></script>
<script src="/Content/js/mobiscroll/plugs/mobiscroll/js/mobiscroll.i18n.zh.js"></script>
<div id="container" class="container"></div>
<script src="~/Content/js/Share.js"></script>
@Html.Partial("~/views/Shared/_ContractPartialPage.cshtml")
<script>
    $(function () {
        $('body').removeClass('bg01');
        InitData();
    })
    //返回修改
    function ToUpdateHnalder() {
        window.location.href = "/Order/OnGenarate?orderNo=" + $.request('orderNo');
    }
    //确认无误，立即提交
    function SureSubmitHnalder() {
        var data = $("#contractForm").serializeObject();
        data["userId"] = $('#Uid').val();
        data["orderNo"] = $.request('orderNo');
        data["contractHtml"] = $('.container').html();
        console.log(data);
        $.ar({
            url: globalKey.InterfaceDomain + 'api/OrderLeaseContract/Update'
           , data: data
           , success: function (data) {
               $.modalMsg({
                   content: "<span style='color: #555;'>租赁合同生成成功，请到我的-租赁合同查看</span>", success: function () {
                       window.location.href = "/Account/MyContract";
                       return false;
                   }
               });
           }
        });
        return false;
    }
    //对表单赋值
    function InitData() {
        $.LayDetails({
            elem: '#container'
               , Template: '#ContractTemplate'
               , mb: 100
               , url: globalKey.InterfaceDomain + 'api/OrderLeaseContract/GetByOrderNo'
               , type: 'post'
               , data: { orderNo: $.request('orderNo') }//参数
               , success: function (contentHtml) {
                   var headHtml = ' <div class="search_listheader" style="background:#fff" onclick="window.history.go(-1);">'
                     + ' <div class="search_listheader_l"><i class="iconfont icon-jiantou-copy1"></i></div>'
                     + '<h2>  房屋租赁合同 </h2>'
                     + ' </div>';
                   var footHtml = '';
                   if (CheckUserLog()) {
                       if ($.request('action') == "view") {
                           footHtml = '<div class="btmline"></div><div class="shaixuan_btm" style="height:50px;line-height:50px;">'
                                                  + '<a href="javascript:void(0);" style="width:20%;background-color: #f7f7f7;width:100%;" onclick="_system._guide(true)">转发</a>'
                                                  + '</div>';
                       }
                       else {
                           footHtml = '<div class="btmline"></div><div class="shaixuan_btm" style="height:50px;line-height:50px;">'
                                                    + '<a href="javascript:void(0);" style="width:20%;background-color: #f7f7f7;" onclick="_system._guide(true)">转发</a>'
                                                    + '<a href="javascript:void(0);" onclick="ToUpdateHnalder()" style="width:20%;">修改</a>'
                                                    + '<a class="bg2" href="javascript:void(0);" onclick="SureSubmitHnalder();" style="width:60%;">确认无误，立即提交</a>'
                                                    + '</div>';
                       }
                   }
                   $('#container').html(headHtml + contentHtml + footHtml);
                   $('input').attr('readonly', true);
               }
        });
    }
    ////初始化时间控件
    //function InitDate() {
    //    var currYear = (new Date()).getFullYear();
    //    //初始化日期控件
    //    $('#contractSignTime,#contractDueTime,#signTime').scroller('destroy').scroller({
    //        preset: 'date',
    //        theme: 'android-ics light',
    //        display: 'bottom',
    //        minDate: new Date(),
    //        endYear: currYear + 5, //结束年份
    //        lang: 'zh'
    //    });
    //    $('#contractSignTime,#contractDueTime,#signTime').each(function (index, obj) {
    //        $(obj).scroller('setVal', $(obj).val(), true);
    //    });
    //}
</script>
<!--微信分享开始-->
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    function WxShare() {
        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: '@Model.AppId', // 必填，公众号的唯一标识
            timestamp: '@Model.Timestamp', // 必填，生成签名的时间戳
            nonceStr: '@Model.NonceStr', // 必填，生成签名的随机串
            signature: '@Model.Signature',// 必填，签名
            jsApiList: [
                    'onMenuShareTimeline',
                    'onMenuShareAppMessage',
                    'onMenuShareQQ',
                    'onMenuShareWeibo'
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2。详见：http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html
        });

        wx.ready(function () {
            var title = '房屋租赁合同';
            var desc = $('.box_main').html();
            var link = window.location.href;
            var imgUrl = globalKey.MobileUrl + "Content/img/contract.png";
            // 2. 分享接口
            // 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
            wx.onMenuShareAppMessage({
                title: title,
                desc: desc,
                link: link,
                imgUrl: imgUrl,
                type: 'link',
                dataUrl: '',
                success: function () {
                    $.modalMsg({ content: '转发成功！' });
                },
                cancel: function () {

                }
            });
            // 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
            wx.onMenuShareTimeline({
                title: title,
                link: link,
                imgUrl: imgUrl,
                success: function (res) {
                    $.modalMsg({ content: '转发成功！' });
                },
                cancel: function (res) {

                },
                fail: function (res) {

                }
            });
            // 2.3 监听“分享到QQ”按钮点击、自定义分享内容及分享结果接口
            wx.onMenuShareQQ({
                title: title,
                desc: desc,
                link: link,
                imgUrl: imgUrl,
                success: function (res) {
                    $.modalMsg({ content: '转发成功！' });
                },
                cancel: function (res) {

                },
            });
            // 2.4 监听“分享到微博”按钮点击、自定义分享内容及分享结果接口
            wx.onMenuShareWeibo({
                title: title,
                desc: desc,
                link: link,
                imgUrl: imgUrl,
                success: function (res) {
                    $.modalMsg({ content: '转发成功！' });
                },
                cancel: function (res) {

                },

            });
        });
        wx.error(function (res) {

        });
    }


</script>
<!--微信分享结束-->
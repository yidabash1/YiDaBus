@{
    ViewBag.Title = " 我的房屋";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Content/js/Share.js"></script>
<script src="/Content/js/zepto.fx.js"></script>
<script type="text/javascript" src="~/Content/js/swipe.min.js"></script>
<style>
    .iprolist_about span {
    float: left;
    color: #666666;
    font-size: 12px;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    width: 100%;
}
    .iprolistc dl dd h3 span {
    background: #FD7A20;
    line-height: 15px;
    color: #fff;
    font-size: 12px;
    border-radius: 3px;
    line-height: 0px;
    float: right;
    padding: 8px 1px;
}
</style>
<div class="box_main">
    <div class="search_listheader" style="background:#fff">
        <div class="search_listheader_l" onclick="return history.go(-1);"><i class="iconfont icon-jiantou-copy1"></i></div>
        <h2> 我的房屋</h2>
        <div class="search_listheader_r" style="width:80px"><a href="/House/Push">添加房屋</a></div>
    </div>
    <div class="iprolist yixiang" style="padding-top: 34px;">
        <div class="iprolist_tab2" style="background:#fff">
            <ul>
                <li flag="1" class="cur">出租中的房屋</li>
                <li flag="2">已租赁房屋</li>
            </ul>
        </div>

        <!---出租中的房屋start-->
        <div class="iprolistc" id="tab1"></div>
        <!---出租中的房屋end-->
        <!---出租中的房屋start-->
        <div class="iprolistc" id="tab2" style="display:none"></div>
        <!---出租中的房屋end-->
    </div>
</div>

<script type="text/html" id="results">
    {{#  layui.each(d, function(index, item){ }}

    {{# if(item.auditStatus==0){ }}      <!---待审核-->
    <div class="fangwu_box">
        <div class="yixiang_box_tit">
            <em style="float:left;"><img width="69" src="/Content/img/daishenhe_icon.png"></em>
        </div>
        <dl>
            <div class="swipe_content">
                <dt><a href="/house/details/{{item.id}}"><img src="{{item.houseCorver}}" onerror="this.onerror='';this.src='/Content/img/ad1.png'"></a></dt>
                <dd>
                    <h3> <a href="/house/details/{{item.id}}">{{item.houseTitle.substring(0,14)}}</a>&nbsp;{{# if(item.rentMode!=""){ }} <span style="line-height: 0px;">{{item.rentMode}}</span>{{# } }}</h3>
                    <div class="iprolist_about">
                        <span>{{item.district}}-{{item.areasName}}</span>
                    </div>
                    <div class="iprolist_adress"><div class="iprolist_price"><em style="color:#333333">￥{{item.hRent}}</em>/月</div></div>
                </dd>
                <div class="liulan_num"><span>浏览 {{item.visitCount}}</span><span>收藏 {{item.collectionNumber}}</span><span>意向 {{item.offerCount}}</span></div>
            </div>
            <div class="swipe_hidden"><a href="javascript:void(0);" onclick="DelHandler('{{item.id}}',0,1);">删除</a></div>
        </dl>
        
    </div>
    {{# }else if(item.auditStatus==1&&item.isOn==1){  }}<!---审核通过 IsOn:1-已上架-->

    <div class="fangwu_box">
        <div class="yixiang_box_tit">
            @*<span class="color_green">出租中</span>*@
            <em style="float:left;"><img width="69" src="/Content/img/chuzuzhong_icon.png"></em>
            <a href="/Account/LPriceList?houseId={{item.id}}"><em><font color="#FF0017">{{item.offerCount}}</font>人出价</em></span></a>
        </div>
        <dl>
            <div class="swipe_content">
                <dt><a href="/house/details/{{item.id}}"><img src="{{item.houseCorver}}" onerror="this.onerror='';this.src='/Content/img/ad1.png'"></a></dt>
                <dd>
                    <h3> <a href="/house/details/{{item.id}}">{{item.houseTitle.substring(0,14)}}</a>&nbsp;{{# if(item.rentMode!=""){ }} <span style="line-height: 0px;">{{item.rentMode}}</span>{{# } }}</h3>
                    <div class="iprolist_about">
                        <span>{{item.district}}-{{item.areasName}}</span>
                    </div>
                    <div class="iprolist_adress"><div class="iprolist_price"><em style="color:#333333">￥{{item.hRent}}</em>/月</div></div>
                </dd>
                <div class="liulan_num"><span>浏览 {{item.visitCount}}</span><span>收藏 {{item.collectionNumber}}</span><span>意向 {{item.interestNumber}}</span></div>
            </div>
            <div class="swipe_hidden"><a href="javascript:void(0);" onclick="DelHandler('{{item.id}}',0,1);">删除</a></div>
        </dl>
        
        <div class="yixiang_box_set w3">
            <ul>
                <li style="width: 48%;"><a href="javascript:void(0);" onclick="setHouseIsOn({{item.id}},0,0);">暂时下架</a></li>
                <li style="width: 48%;"><a href="/house/details/{{item.id}}?action=share">分享给朋友</a></li>
            </ul>
        </div>
    </div>
    {{# }else if(item.auditStatus==1&&item.isOn==0){ }}<!---审核通过 IsOn:0-未上架-->
    <div class="fangwu_box">
        <div class="yixiang_box_tit">
            @*<span class="color_orange">待上架</span>*@
            <em style="float:left;"><img width="69" src="/Content/img/daishangjia_icon.png"></em>
        </div>
        <dl>
            <div class="swipe_content">
                <dt><a href="/house/details/{{item.id}}"><img src="{{item.houseCorver}}" onerror="this.onerror='';this.src='/Content/img/ad1.png'"></a></dt>
                <dd>
                    <h3> <a href="/house/details/{{item.id}}">{{item.houseTitle.substring(0,14)}}</a>&nbsp;{{# if(item.rentMode!=""){ }} <span style="line-height: 0px;">{{item.rentMode}}</span>{{# } }}</h3>
                    <div class="iprolist_about">
                        <span>{{item.district}}-{{item.areasName}}</span>
                    </div>
                    <div class="iprolist_adress"><div class="iprolist_price"><em style="color:#333333">￥{{item.hRent}}</em>/月</div></div>
                </dd>
                <div class="liulan_num"><span>浏览 {{item.visitCount}}</span><span>收藏 {{item.collectionNumber}}</span><span>意向 {{item.interestNumber}}</span></div>
            </div>
            <div class="swipe_hidden"><a href="javascript:void(0);" onclick="DelHandler('{{item.id}}',0,1);">删除</a></div>
        </dl>
        <div class="yixiang_box_set w3">
            <ul>
                <li style="width: 48%;"><a href="javascript:void(0);" onclick="setHouseIsOn({{item.id}},1,0);">立即上架</a></li>
                <li style="width: 48%;"><a href="/house/details/{{item.id}}?action=share">分享给朋友</a></li>
            </ul>
        </div>
    </div>
    {{# }else if(item.auditStatus==2){ }}<!---审核失败-->
    <div class="fangwu_box hui">
        <div class="yixiang_box_tit">
            @*<span class="color_hui">审核失败</span>*@
            <em style="float:left;"><img width="69" src="/Content/img/fail_icon.png"></em>
        </div>
        <dl>
            <div class="swipe_content">
                <dt><a href="/house/details/{{item.id}}"><img src="{{item.houseCorver}}" onerror="this.onerror='';this.src='/Content/img/ad1.png'"></a></dt>
                <dd>
                    <h3> <a href="/house/details/{{item.id}}">{{item.houseTitle.substring(0,14)}}</a>&nbsp;{{# if(item.rentMode!=""){ }} <span style="line-height: 0px;">{{item.rentMode}}</span>{{# } }}</h3>
                    <div class="iprolist_about">
                        <span>{{item.district}}-{{item.areasName}}</span>
                    </div>
                    <div class="iprolist_adress"><div class="iprolist_price"><em>￥{{item.hRent}}</em>/月</div></div>
                </dd>
                <div class="liulan_num"><span>浏览 {{item.visitCount}}</span><span>收藏 {{item.collectionNumber}}</span><span>意向 {{item.interestNumber}}</span></div>
            </div>
            <div class="swipe_hidden"><a href="javascript:void(0);" onclick="DelHandler('{{item.id}}',0,1);">删除</a></div>
        </dl>
    </div>
    {{# } }}

    {{#  }); }}
    {{#  if(d.length === 0){ }}
    <div class="search_null">
        <dl><dt style="float: none;width:100%;"><img width="75" src="/Content/img/tousu_nullicon.png"></dt><dd style="margin-left: 0px;">暂无房源</dd></dl>
    </div>
    {{#  } }}
</script>

<script type="text/html" id="results1">
    {{#  layui.each(d, function(index, item){ }}

    <div class="fangwu_box">
        @*<div class="yixiang_box_tit">{{item.renterName}}确认租赁 </div>*@
        <div class="yixiang_box_tit">
            <a href="tel:{{item.renterTel}}" style="float: left;"><i class="icon iconfont icon-phone-alt" style="font-size: 17px;"></i></a>
            <em><img width="69" src="/Content/img/chegnjiao_icon.png"></em>
        </div>
        <dl>
            <div class="swipe_content">
                <dt><a href="/house/details/{{item.id}}"><img src="{{item.houseCorver}}" onerror="this.onerror='';this.src='/Content/img/ad1.png'"></a></dt>
                <dd>
                    <h3> <a href="/house/details/{{item.id}}">{{item.houseTitle.substring(0,14)}}</a>&nbsp;{{# if(item.rentMode!=""){ }} <span style="line-height: 0px;">{{item.rentMode}}</span>{{# } }}</h3>
                    <div class="iprolist_about">
                        <span>{{item.district}}-{{item.areasName}}</span>
                    </div>

                    <div class="iprolist_adress"><div class="iprolist_price"><em style="color:#333333">￥{{item.hRent}}</em>/月</div></div>
                </dd>
            </div>
            <div class="swipe_hidden"><a href="javascript:void(0);" onclick="DelHandler('{{item.id}}',0,1);">删除</a></div>
        </dl>
        <div class="yixiang_box_set w50">
            <ul>
                <li style="width:100%"><a href="/order/ContractDetail?orderNo={{item.houseOrderNo}}&action=view">查看合同</a></li>
            </ul>
        </div>
    </div>
    {{#  }); }}
    {{#  if(d.length === 0){ }}
    <div class="search_null">
        <dl>
            <dt style="float: none;width:100%;"><img width="75" src="/Content/img/tousu_nullicon.png"></dt>
            <dd style="margin-left: 0px;">暂无房源</dd>
        </dl>
    </div>
    {{#  } }}
</script>



<script type="text/javascript">
    $(function () {
        loadresult(0, "tab1", "results");
        $(".iprolist_tab2 ul li").mousedown(function () {
            $(".iprolist_tab2 ul li").each(function () {
                $(this).removeClass();
            });
            var flag = $(this).attr("flag");
            $(this).addClass("cur");
            $(".iprolistc").hide();
            $("#tab" + flag).show();
            if (flag == 1) {
                loadresult(0, "tab1", "results");
            } else {
                loadresult(1, "tab2", "results1");
            }
        });
    })

    //出租中的房屋
    function loadresult(type, elemId, tetemplateId) {
        var data = {
            pagesize: 5,
            UserIdEncrypt: $('#Uid').val(),
            HStatus: type
        };
        $.LayPage({
            elem: '#' + elemId
      , Template: '#' + tetemplateId
      , mb: 100
      , url: globalKey.InterfaceDomain + 'api/House/OwnerList'
      , type: 'post'
      , load: false
      , data: data//参数
      , NullColor: '#f5f5f5'
        });
    };

    //上架、下架房源
    function setHouseIsOn(houseId, isOn, isDelete) {

        $.ar({
            url: globalKey.InterfaceDomain + 'api/House/SetHouseIsOn'
                               , data: { UserIdEncrypt: $('#Uid').val(), IsOn: isOn, Id: houseId, IsDel: isDelete }
                               , success: function (data) {
                                   $.modalMsg({
                                       content: "操作成功",
                                       success: function () {
                                           window.location.href = "/Account/MyHouse";
                                       }
                                   });
                               }
        });
    }

    //下架/删除房源
    function DelHandler(houseId, isOn, isDelete) {
        $(".swipe_content").css("transform", "translate3d(0px, 0px, 0px)");
        $.BottomDialog({
            content: '您确认要<span style="color:red;">删除</span>该房源吗?'
                    , callBack: function () {
                        setHouseIsOn(houseId, isOn, isDelete);
                        return false;
                    }
        });


    }

</script>